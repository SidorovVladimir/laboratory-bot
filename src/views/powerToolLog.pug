extends layout.pug
block content
  body
    p –ñ—É—Ä–Ω–∞–ª —É—á–µ—Ç–∞, –æ—Å–º–æ—Ç—Ä–∞ –∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞.
   
    .table-container
      table.custom-table
        thead
          tr
            th –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
            th –ò–Ω–≤–µ—Ä—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä
            th –î–∞—Ç–∞ –æ—Å–º–æ—Ç—Ä–∞ –∏ –∏—Å–ø—ã—Ç–∞–Ω–∏–π
            th –î–µ–π—Å—Ç–≤–∏—è
        tbody
          each list in lists
            tr
              td= list.name
              td= list.inventory_number
              td
                span(id=`date-text-${list.id}`) #{new Date(list.date).toLocaleDateString('ru-RU')}
              td
                button.btn-refresh(onclick=`refreshDate('${list.id}')`) üîÑ –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

    script.
      const tg = window.Telegram?.WebApp;

      if (!tg) {
        document.body.innerHTML = "<p>–û—à–∏–±–∫–∞: –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram.</p>";
        throw new Error("–ù–µ –≤ Telegram");
      }

      tg.ready();
      tg.expand();

      async function refreshDate(id) {
        try {
          const response = await fetch(`/api/journals/power-tool-inspection-log/update/${id}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' }
        });

        if (response.ok) {
          const data = await response.json();
          const newDate = new Date(data.date).toLocaleDateString('ru-RU'); 

          const el = document.getElementById(`date-text-${id}`);
          if (el) el.innerText = newDate;

          tg.showAlert('–î–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
          //- window.location.reload(); 
        } else {
          tg.showPopup({ message: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞—Ç—ã' });
        }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞:', err);
        }
      }