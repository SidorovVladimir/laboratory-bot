extends layout.pug
block content
  body
    p –ñ—É—Ä–Ω–∞–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∂–∞—Ä–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∞.
   
    .table-container
      table.custom-table
        thead
          tr
            th –î–∞—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∞
            th –§–ò–û
            th –î–æ–ª–∂–Ω–æ—Å—Ç—å
            th –í–∏–¥ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∞
            th –î–µ–π—Å—Ç–≤–∏—è
        tbody
          each list in lists
            tr
              td
                span(id=`date-text-${list.id}`) #{new Date(list.date).toLocaleDateString('ru-RU')}
              td= list.full_name
              td= list.job_title
              td= list.briefing_type
              td
                button.btn-refresh(onclick=`refreshDate('${list.id}')`) üîÑ –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

    script.
      const tg = window.Telegram?.WebApp;

      if (!tg) {
        document.body.innerHTML = "<p>–û—à–∏–±–∫–∞: –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram.</p>";
        throw new Error("–ù–µ –≤ Telegram");
      }

      tg.ready();
      tg.expand();

      async function refreshDate(id) {
        try {
          const response = await fetch(`/api/journals/fire-briefing-log/update/${id}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' }
        });

        if (response.ok) {
          const data = await response.json();
          const newDate = new Date(data.date).toLocaleDateString('ru-RU'); 

          const el = document.getElementById(`date-text-${id}`);
          if (el) el.innerText = newDate;

          tg.showAlert('–î–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
          //- window.location.reload(); 
        } else {
          tg.showPopup({ message: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞—Ç—ã' });
        }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞:', err);
        }
      }